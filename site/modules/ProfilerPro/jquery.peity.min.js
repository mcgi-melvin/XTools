(function(d,f,b,c){var a=d.fn.peity=function(k,j){if(e){this.each(function(){var m=d(this);var l=m.data("_peity");if(l){if(k){l.type=k}d.extend(l.opts,j)}else{l=new i(m,k,d.extend({},a.defaults[k],m.data("peity"),j));m.change(function(){l.draw()}).data("_peity",l)}l.draw()})}return this};var i=function(j,k,l){this.$el=j;this.type=k;this.opts=l};var h=i.prototype;var g=h.svgElement=function(j,k){return d(f.createElementNS("http://www.w3.org/2000/svg",j)).attr(k)};var e="createElementNS" in f&&g("svg",{})[0].createSVGRect;h.draw=function(){var j=this.opts;a.graphers[this.type].call(this,j);if(j.after){j.after.call(this,j)}};h.fill=function(){var j=this.opts.fill;return d.isFunction(j)?j:function(k,l){return j[l%j.length]}};h.prepare=function(k,j){if(!this.$svg){this.$el.hide().after(this.$svg=g("svg",{"class":"peity"}))}return this.$svg.empty().data("peity",this).attr({height:j,width:k})};h.values=function(){return d.map(this.$el.text().split(this.opts.delimiter),function(j){return parseFloat(j)})};a.defaults={};a.graphers={};a.register=function(j,k,l){this.defaults[j]=k;this.graphers[j]=l};a.register("pie",{fill:["#ff9900","#fff4dd","#ffc66e"],radius:8},function(w){if(!w.delimiter){var I=this.$el.text().match(/[^0-9\.]/);w.delimiter=I?I[0]:","}var j=d.map(this.values(),function(L){return L>0?L:0});if(w.delimiter=="/"){var m=j[0];var k=j[1];j=[m,b.max(0,k-m)]}var D=0;var r=j.length;var n=0;for(;D<r;D++){n+=j[D]}if(!n){r=2;n=1;j=[0,1]}var v=w.radius*2;var J=this.prepare(w.width||v,w.height||v);var A=J.width(),y=J.height(),q=A/2,o=y/2;var s=b.min(q,o),u=w.innerRadius;if(this.type=="donut"&&!u){u=s*0.5}var H=b.PI;var C=this.fill();var K=this.scale=function(M,L){var N=M/n*H*2-H/2;return[L*b.cos(N)+q,L*b.sin(N)+o]};var z=0;for(D=0;D<r;D++){var B=j[D],x=B/n,G;if(x==0){continue}if(x==1){if(u){var E=q-0.01,p=o-s,l=o-u;G=g("path",{d:["M",q,p,"A",s,s,0,1,1,E,p,"L",E,l,"A",u,u,0,1,0,q,l].join(" ")})}else{G=g("circle",{cx:q,cy:o,r:s})}}else{var t=z+B;var F=["M"].concat(K(z,s),"A",s,s,0,x>0.5?1:0,1,K(t,s),"L");if(u){F=F.concat(K(t,u),"A",u,u,0,x>0.5?1:0,0,K(z,u))}else{F.push(q,o)}z+=B;G=g("path",{d:F.join(" ")})}G.attr("fill",C.call(this,B,D,j));J.append(G)}});a.register("donut",d.extend(true,{},a.defaults.pie),function(j){a.graphers.pie.call(this,j)});a.register("line",{delimiter:",",fill:"#c6d9fd",height:16,min:0,stroke:"#4d89f9",strokeWidth:1,width:32},function(j){var v=this.values();if(v.length==1){v.push(v[0])}var q=b.max.apply(b,j.max==c?v:v.concat(j.max)),n=b.min.apply(b,j.min==c?v:v.concat(j.min));var k=this.prepare(j.width,j.height),s=j.strokeWidth,l=k.width(),w=k.height()-s,t=q-n;var u=this.x=function(x){return x*(l/(v.length-1))};var m=this.y=function(x){var z=w;if(t){z-=((x-n)/t)*w}return z+s/2};var p=m(b.max(n,0)),r=[0,p];for(var o=0;o<v.length;o++){r.push(u(o),m(v[o]))}r.push(l,p);if(j.fill){k.append(g("polygon",{fill:j.fill,points:r.join(" ")}))}if(s){k.append(g("polyline",{fill:"none",points:r.slice(2,r.length-2).join(" "),stroke:j.stroke,"stroke-width":s,"stroke-linecap":"square"}))}});a.register("bar",{delimiter:",",fill:["#4D89F9"],height:16,min:0,padding:0.1,width:32},function(q){var j=this.values(),A=b.max.apply(b,q.max==c?j:j.concat(q.max)),y=b.min.apply(b,q.min==c?j:j.concat(q.min));var D=this.prepare(q.width,q.height),u=D.width(),s=D.height(),p=A-y,r=q.padding,z=this.fill();var E=this.x=function(w){return w*u/j.length};var l=this.y=function(w){return s-(p?((w-y)/p)*s:1)};for(var B=0;B<j.length;B++){var n=E(B+r),o=E(B+1-r)-n,v=j[B],t=l(v),m=t,k=t,C;if(!p){C=1}else{if(v<0){m=l(b.min(A,0))}else{k=l(b.max(y,0))}}C=k-m;if(C==0){C=1;if(A>0&&p){m--}}D.append(g("rect",{fill:z.call(this,v,B,j),x:n,y:m,width:o,height:C}))}})})(jQuery,document,Math);